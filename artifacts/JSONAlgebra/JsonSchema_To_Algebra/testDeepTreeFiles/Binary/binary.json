{
  "allOf": [
    {
      "$ref": "#/$defs/binary"
    },
    {
      "minProperties": 2
    },
    {
      "additionalProperties": {
        "$ref": "#/$defs/tc1"
      }
    },
    {
      "additionalProperties": {
        "$ref": "#/$defs/tc2"
      }
    }
  ],
  "$defs": {
    "tc2": {
      "additionalProperties": {
        "$ref": "#/$defs/tc1"
      }
    },
    "tc1": {
      "minProperties": 2
    },
    "tc3": {
      "additionalProperties": {
        "$ref": "#/$defs/tc2"
      }
    },
    "binary": {
      "type": "object",
      "patternProperties": {
        "^(foo|bar)$": {
          "$ref": "#/$defs/binary"
        }
      },
      "additionalProperties": false
    }
  }
}
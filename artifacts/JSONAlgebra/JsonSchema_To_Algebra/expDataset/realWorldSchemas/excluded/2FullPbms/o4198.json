{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "id": "http://dtls.nl/schemas/dmp-knowledge-model/alt/",
  "description": "Alternative JSON file describing a single chapter in the knowledge model for DMP questionnaires. Schema is divided into common, core and local parts and tries to be as much restrictive as is possible and needed.",
  "definitions": {
    "common": {
      "type": "object",
      "properties": {
        "formatversion": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1
        },
        "namespace": {
          "type": "string"
        },
        "ids": {
          "type": "object",
          "properties": {
            "chapterid": {
              "type": "integer",
              "minimum": 1,
              "maximum": 7
            },
            "questionid": {
              "type": "integer",
              "minimum": 1
            },
            "answerid": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "uids": {
          "type": "object",
          "properties": {
            "shortuid": {
              "type": "string",
              "pattern": "^[a-z]{3,5}$"
            }
          }
        },
        "questionpointer": {
          "type": "object",
          "properties": {
            "namespace": {
              "$ref": "#/definitions/common/properties/namespace"
            },
            "questionid": {
              "$ref": "#/definitions/common/properties/ids/properties/questionid"
            }
          },
          "required": [
            "questionid",
            "namespace"
          ],
          "additionalProperties": false
        },
        "precondition": {
          "type": "object",
          "properties": {
            "namespace": {
              "$ref": "#/definitions/common/properties/namespace"
            },
            "questionid": {
              "$ref": "#/definitions/common/properties/ids/properties/questionid"
            },
            "answerid": {
              "$ref": "#/definitions/common/properties/ids/properties/answerid"
            }
          },
          "required": [
            "questionid"
          ],
          "additionalProperties": false
        },
        "experts": {
          "type": "object",
          "properties": {
            "expert": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "email": {
                  "type": "string",
                  "format": "email"
                },
                "class": {
                  "type": "string",
                  "enum": [
                    "individual",
                    "organisation"
                  ],
                  "default": "organisation"
                }
              },
              "required": [
                "name"
              ]
            },
            "experts": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/common/properties/experts/properties/expert"
              },
              "default": []
            }
          }
        },
        "references": {
          "type": "object",
          "properties": {
            "dmpbookreference": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "dmpbook"
                  ]
                },
                "chapter": {
                  "type": "string"
                }
              },
              "required": [
                "type",
                "chapter"
              ],
              "additionalProperties": false
            },
            "urlreference": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "url"
                  ]
                },
                "weblink": {
                  "type": "string",
                  "format": "uri"
                },
                "anchor": {
                  "type": "string"
                }
              },
              "required": [
                "type",
                "weblink"
              ],
              "additionalProperties": false
            },
            "crossreference": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "xref"
                  ]
                },
                "chapterid": {
                  "$ref": "#/definitions/common/properties/ids/properties/chapterid"
                },
                "questionid": {
                  "$ref": "#/definitions/common/properties/ids/properties/questionid"
                },
                "namespace": {
                  "$ref": "#/definitions/common/properties/namespace"
                }
              },
              "required": [
                "type",
                "chapterid",
                "questionid"
              ],
              "additionalProperties": false
            },
            "resourcepagereference": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "resourcepage"
                  ]
                },
                "shortuid": {
                  "$ref": "#/definitions/common/properties/uids/properties/shortuid"
                }
              },
              "required": [
                "type",
                "shortuid"
              ],
              "additionalProperties": false
            },
            "reference": {
              "anyOf": [
                {
                  "$ref": "#/definitions/common/properties/references/properties/dmpbookreference"
                },
                {
                  "$ref": "#/definitions/common/properties/references/properties/resourcepagereference"
                },
                {
                  "$ref": "#/definitions/common/properties/references/properties/urlreference"
                },
                {
                  "$ref": "#/definitions/common/properties/references/properties/crossreference"
                }
              ]
            },
            "references": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/common/properties/references/properties/reference"
              },
              "default": []
            }
          }
        },
        "answers": {
          "type": "object",
          "properties": {
            "optionanswer": {
              "type": "object",
              "properties": {
                "id": {
                  "$ref": "#/definitions/common/properties/ids/properties/answerid"
                },
                "label": {
                  "type": "string"
                },
                "advice": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "label"
              ],
              "additionalProperties": false
            },
            "optionanswers": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/common/properties/answers/properties/optionanswer"
              },
              "minItems": 2
            }
          }
        },
        "questions": {
          "type": "object",
          "properties": {
            "question": {
              "type": "object",
              "properties": {
                "questionid": {
                  "$ref": "#/definitions/common/properties/ids/properties/questionid"
                },
                "title": {
                  "type": "string"
                },
                "text": {
                  "type": "string"
                },
                "precondition": {
                  "$ref": "#/definitions/common/properties/precondition"
                },
                "references": {
                  "$ref": "#/definitions/common/properties/references/properties/references"
                },
                "experts": {
                  "$ref": "#/definitions/common/properties/experts/properties/experts"
                }
              },
              "required": [
                "questionid"
              ]
            },
            "optionquestion": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "option"
                  ]
                },
                "answers": {
                  "$ref": "#/definitions/common/properties/answers/properties/optionanswers"
                }
              },
              "required": [
                "type",
                "answers"
              ]
            },
            "fieldquestion": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "list",
                    "number",
                    "string",
                    "text",
                    "date"
                  ]
                }
              },
              "required": [
                "type"
              ]
            }
          }
        },
        "chapter": {
          "type": "object",
          "properties": {
            "chapterid": {
              "$ref": "#/definitions/common/properties/ids/properties/chapterid"
            },
            "namespace": {
              "$ref": "#/definitions/common/properties/namespace"
            },
            "formatversion": {
              "$ref": "#/definitions/common/properties/formatversion"
            },
            "title": {
              "type": "string"
            },
            "text": {
              "type": "string"
            }
          },
          "required": [
            "chapterid",
            "namespace",
            "formatversion"
          ]
        }

      }
    },
    "core": {
      "type": "object",
      "properties": {
        "namespace": {
          "type": "string",
          "enum": [
            "core"
          ]
        },
        "precondition": {
          "allOf": [
            {
              "$ref": "#/definitions/common/properties/precondition"
            },
            {
              "properties": {
                "namespace": {
                  "$ref": "#/definitions/core/properties/namespace"
                }
              }
            }
          ]
        },
        "references": {
          "type": "object",
          "properties": {
            "crossreference": {
              "allOf": [
                {
                  "$ref": "#/definitions/common/properties/references/properties/crossreference"
                },
                {
                  "properties": {
                    "namespace": {
                      "$ref": "#/definitions/core/properties/namespace"
                    }
                  }
                }
              ]
            },
            "reference": {
              "anyOf": [
                {
                  "$ref": "#/definitions/common/properties/references/properties/dmpbookreference"
                },
                {
                  "$ref": "#/definitions/common/properties/references/properties/urlreference"
                },
                {
                  "$ref": "#/definitions/common/properties/references/properties/resourcepagereference"
                },
                {
                  "$ref": "#/definitions/core/properties/references/properties/crossreference"
                }
              ]
            },
            "references": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/core/properties/references/properties/reference"
              },
              "default": []
            }
          }
        },
        "questions": {
          "type": "object",
          "properties": {
            "abstract_question": {
              "allOf": [
                {
                  "$ref": "#/definitions/common/properties/questions/properties/question"
                },
                {
                  "properties": {
                    "title": {
                      "type": "string"
                    },
                    "precondition": {
                      "$ref": "#/definitions/core/properties/precondition"
                    },
                    "references": {
                      "$ref": "#/definitions/core/properties/references/properties/references"
                    }
                  },
                  "required": [
                    "questionid",
                    "title"
                  ]
                }
              ]
            },
            "optionquestion": {
              "allOf": [
                {
                  "$ref": "#/definitions/core/properties/questions/properties/abstract_question"
                },
                {
                  "$ref": "#/definitions/common/properties/questions/properties/optionquestion"
                }
              ]
            },
            "fieldquestion": {
              "allOf": [
                {
                  "$ref": "#/definitions/core/properties/questions/properties/abstract_question"
                },
                {
                  "$ref": "#/definitions/common/properties/questions/properties/fieldquestion"
                }
              ]
            },
            "question": {
              "anyOf": [
                {
                  "$ref": "#/definitions/core/properties/questions/properties/optionquestion"
                },
                {
                  "$ref": "#/definitions/core/properties/questions/properties/fieldquestion"
                }
              ]
            },
            "questions": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/core/properties/questions/properties/question"
              },
              "default": []
            }
          }
        },
        "chapter": {
          "allOf": [
            {
              "$ref": "#/definitions/common/properties/chapter"
            },
            {
              "properties": {
                "namespace": {
                  "$ref": "#/definitions/core/properties/namespace"
                },
                "title": {
                  "type": "string"
                },
                "questions": {
                  "$ref": "#/definitions/core/properties/questions/properties/questions"
                }
              },
              "required": [
                "questions",
                "title"
              ]
            }
          ]
        }
      }
    },
    "local": {
      "type": "object",
      "properties": {
        "namespace": {
          "allOf": [
            {
              "not": {
                "$ref": "#/definitions/core/properties/namespace"
              }
            },
            {
              "type": "string"
            }
          ]
        },
        "questions": {
          "type": "object",
          "properties": {
            "abstract_question": {
              "allOf": [
                {
                  "$ref": "#/definitions/common/properties/questions/properties/question"
                },
                {
                  "properties": {
                    "namespace": {
                      "$ref": "#/definitions/common/properties/namespace"
                    },
                    "insertBefore": {
                      "$ref": "#/definitions/common/properties/questionpointer"
                    },
                    "addReferences": {
                      "$ref": "#/definitions/common/properties/references/properties/references"
                    },
                    "addExperts": {
                      "$ref": "#/definitions/common/properties/experts/properties/experts"
                    }
                  },
                  "required": [
                    "namespace"
                  ]
                }
              ]
            },
            "optionquestionL": {
              "allOf": [
                {
                  "$ref": "#/definitions/local/properties/questions/properties/abstract_question"
                },
                {
                  "properties": {
                    "addAnswers": {
                      "$ref": "#/definitions/common/properties/answers/properties/optionanswers"
                    }
                  }
                }
              ]
            },
            "fieldquestionL": {
              "allOf": [
                {
                  "$ref": "#/definitions/local/properties/questions/properties/abstract_question"
                },
                {
                  "$ref": "#/definitions/common/properties/questions/properties/fieldquestion"
                }
              ]
            },
            "optionquestionC": {
              "allOf": [
                {
                  "$ref": "#/definitions/core/properties/questions/properties/abstract_question"
                },
                {
                  "properties": {
                    "insertBefore": {
                      "$ref": "#/definitions/common/properties/questionpointer"
                    }
                  }
                },
                {
                  "$ref": "#/definitions/common/properties/questions/properties/optionquestion"
                }
              ]
            },
            "fieldquestionC": {
              "allOf": [
                {
                  "$ref": "#/definitions/core/properties/questions/properties/abstract_question"
                },
                {
                  "properties": {
                    "insertBefore": {
                      "$ref": "#/definitions/common/properties/questionpointer"
                    }
                  }
                },
                {
                  "$ref": "#/definitions/common/properties/questions/properties/fieldquestion"
                }
              ]
            },
            "question": {
              "anyOf": [
                {
                  "$ref": "#/definitions/local/properties/questions/properties/optionquestionL"
                },
                {
                  "$ref": "#/definitions/local/properties/questions/properties/fieldquestionL"
                },
                {
                  "$ref": "#/definitions/local/properties/questions/properties/optionquestionC"
                },
                {
                  "$ref": "#/definitions/local/properties/questions/properties/fieldquestionC"
                }
              ]
            },
            "questions": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/local/properties/questions/properties/question"
              },
              "default": []
            }
          }
        },
        "chapter": {
          "allOf": [
            {
              "$ref": "#/definitions/common/properties/chapter"
            },
            {
              "properties": {
                "namespace": {
                  "$ref": "#/definitions/local/properties/namespace"
                },
                "questions": {
                  "$ref": "#/definitions/local/properties/questions/properties/questions"
                }
              },
              "required": [
                "namespace",
                "questions"
              ]
            }
          ]
        }
      }
    }
  },
  "anyOf": [
    {
      "$ref": "#/definitions/core/properties/chapter"
    },
    {
      "$ref": "#/definitions/local/properties/chapter"
    }
  ]
}

{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "id": "http://dtls.nl/schemas/dmp-knowledge-model/chapter/",
  "description": "JSON file describing a single chapter in the knowledge model for DMP questionnaires. Schema is divided into common, core and local parts and tries to be as much restrictive as is possible and needed.",
  "definitions": {
    "common": {
      "formatversion": {
        "type": "integer",
        "minimum": 2,
        "maximum": 2
      },
      "namespace": {
        "type": "string"
      },
      "uids": {
        "uuid": {
          "type": "string",
          "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
        },
        "shortuid": {
          "type": "string",
          "pattern": "^[a-z]{3,5}$"
        }
      },
      "experts": {
        "expert": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "name": {
              "type": "string"
            },
            "email": {
              "type": "string",
              "format": "email"
            },
            "class": {
              "type": "string",
              "enum": [
                "individual",
                "organisation"
              ],
              "default": "organisation"
            }
          },
          "required": [
            "uuid",
            "name"
          ]
        },
        "experts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/common/experts/expert"
          },
          "default": []
        }
      },
      "references": {
        "dmpbookreference": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "type": {
              "type": "string",
              "enum": [
                "dmpbook"
              ]
            },
            "chapter": {
              "type": "string"
            }
          },
          "required": [
            "uuid",
            "type",
            "chapter"
          ],
          "additionalProperties": false
        },
        "urlreference": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "type": {
              "type": "string",
              "enum": [
                "url"
              ]
            },
            "weblink": {
              "type": "string",
              "format": "uri"
            },
            "anchor": {
              "type": "string"
            }
          },
          "required": [
            "uuid",
            "type",
            "weblink"
          ],
          "additionalProperties": false
        },
        "crossreference": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "target": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "description": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "xref"
              ]
            },
            "namespace": {
              "$ref": "#/definitions/common/namespace"
            }
          },
          "required": [
            "uuid",
            "type",
            "target",
            "description"
          ],
          "additionalProperties": false
        },
        "resourcepagereference": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "type": {
              "type": "string",
              "enum": [
                "resourcepage"
              ]
            },
            "shortuid": {
              "$ref": "#/definitions/common/uids/shortuid"
            }
          },
          "required": [
            "uuid",
            "type",
            "shortuid"
          ],
          "additionalProperties": false
        },
        "reference": {
          "anyOf": [
            {
              "$ref": "#/definitions/common/references/dmpbookreference"
            },
            {
              "$ref": "#/definitions/common/references/resourcepagereference"
            },
            {
              "$ref": "#/definitions/common/references/urlreference"
            },
            {
              "$ref": "#/definitions/common/references/crossreference"
            }
          ]
        },
        "references": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/common/references/reference"
          },
          "default": []
        }
      },
      "metrics": {
        "metric_measure": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "measure": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "weight": {
              "type": "number",
              "minimum": 0,
              "default": 1
            }
          },
          "required": [
            "uuid",
            "measure"
          ]
        },
        "metric_measures": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/common/metrics/metric_measure"
          },
          "default": []
        }
      },
      "integrations": {
        "integration": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "type": {
              "type": "string"
            },
            "params": {
              "type": "object"
            },
            "credits": {
              "type": "string"
            }
          },
          "required": [
            "uuid",
            "type",
            "params",
            "credits"
          ]
        },
        "integrations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/common/integrations/integration"
          }
        }
      },
      "project_phase": {
        "type": "integer",
        "minimum": 1,
        "maximum": 4,
        "default": 2
      },
      "answers": {
        "optionanswer": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "label": {
              "type": "string"
            },
            "advice": {
              "type": "string"
            },
            "metrics": {
              "$ref": "#/definitions/common/metrics/metric_measures"
            }
          },
          "required": [
            "uuid",
            "label"
          ]
        },
        "optionanswers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/common/answers/optionanswer"
          },
          "minItems": 1
        }
      },
      "questions": {
        "question": {
          "type": "object",
          "properties": {
            "uuid": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "phase": {
              "$ref": "#/definitions/common/project_phase"
            },
            "title": {
              "type": "string"
            },
            "text": {
              "type": "string"
            },
            "precondition": {
              "$ref": "#/definitions/common/uids/uuid"
            },
            "references": {
              "$ref": "#/definitions/common/references/references"
            },
            "experts": {
              "$ref": "#/definitions/common/experts/experts"
            },
            "integrations": {
              "$ref": "#/definitions/common/integrations/integrations"
            }
          },
          "required": [
            "uuid"
          ]
        },
        "optionquestion": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "option"
              ]
            },
            "answers": {
              "$ref": "#/definitions/common/answers/optionanswers"
            }
          },
          "required": [
            "type",
            "answers"
          ]
        },
        "fieldquestion": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "list",
                "number",
                "string",
                "text",
                "date"
              ]
            }
          },
          "required": [
            "type"
          ]
        }
      },
      "chapter": {
        "type": "object",
        "properties": {
          "uuid": {
            "$ref": "#/definitions/common/uids/uuid"
          },
          "namespace": {
            "$ref": "#/definitions/common/namespace"
          },
          "formatversion": {
            "$ref": "#/definitions/common/formatversion"
          },
          "title": {
            "type": "string"
          },
          "text": {
            "type": "string"
          }
        },
        "required": [
          "uuid",
          "namespace",
          "formatversion"
        ]
      }
    },
    "core": {
      "namespace": {
        "type": "string",
        "enum": [
          "core"
        ]
      },
      "references": {
        "crossreference": {
          "allOf": [
            {
              "$ref": "#/definitions/common/references/crossreference"
            },
            {
              "properties": {
                "namespace": {
                  "$ref": "#/definitions/core/namespace"
                }
              }
            }
          ]
        },
        "reference": {
          "anyOf": [
            {
              "$ref": "#/definitions/common/references/dmpbookreference"
            },
            {
              "$ref": "#/definitions/common/references/urlreference"
            },
            {
              "$ref": "#/definitions/common/references/resourcepagereference"
            },
            {
              "$ref": "#/definitions/core/references/crossreference"
            }
          ]
        },
        "references": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/core/references/reference"
          },
          "default": []
        }
      },
      "questions": {
        "abstract_question": {
          "allOf": [
            {
              "$ref": "#/definitions/common/questions/question"
            },
            {
              "properties": {
                "title": {
                  "type": "string"
                },
                "references": {
                  "$ref": "#/definitions/core/references/references"
                }
              },
              "required": [
                "uuid",
                "title"
              ]
            }
          ]
        },
        "optionquestion": {
          "allOf": [
            {
              "$ref": "#/definitions/core/questions/abstract_question"
            },
            {
              "$ref": "#/definitions/common/questions/optionquestion"
            }
          ]
        },
        "fieldquestion": {
          "allOf": [
            {
              "$ref": "#/definitions/core/questions/abstract_question"
            },
            {
              "$ref": "#/definitions/common/questions/fieldquestion"
            }
          ]
        },
        "question": {
          "anyOf": [
            {
              "$ref": "#/definitions/core/questions/optionquestion"
            },
            {
              "$ref": "#/definitions/core/questions/fieldquestion"
            }
          ]
        },
        "questions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/core/questions/question"
          },
          "default": []
        }
      },
      "chapter": {
        "allOf": [
          {
            "$ref": "#/definitions/common/chapter"
          },
          {
            "properties": {
              "namespace": {
                "$ref": "#/definitions/core/namespace"
              },
              "title": {
                "type": "string"
              },
              "questions": {
                "$ref": "#/definitions/core/questions/questions"
              }
            },
            "required": [
              "questions",
              "title"
            ]
          }
        ]
      }
    },
    "local": {
      "namespace": {
        "allOf": [
          {
            "not": {
              "$ref": "#/definitions/core/namespace"
            }
          },
          {
            "type": "string"
          }
        ]
      },
      "answers": {
        "optionanswer": {
          "allOf": [
            {
              "$ref": "#/definitions/common/answers/optionanswer"
            },
            {
              "type": "object",
              "properties": {
                "addMetrics": {
                  "$ref": "#/definitions/common/metrics/metric_measures"
                }
              }
            }
          ]
        },
        "optionanswers": {
          "type": "array",
          "items": {
            "anyOf": [
              {
                "$ref": "#/definitions/common/answers/optionanswer"
              },
              {
                "$ref": "#/definitions/local/answers/optionanswer"
              }
            ]
          },
          "minItems": 2
        }
      },
      "questions": {
        "abstract_question": {
          "allOf": [
            {
              "$ref": "#/definitions/common/questions/question"
            },
            {
              "properties": {
                "namespace": {
                  "$ref": "#/definitions/common/namespace"
                },
                "insertBefore": {
                  "$ref": "#/definitions/common/uids/uuid"
                },
                "addReferences": {
                  "$ref": "#/definitions/common/references/references"
                },
                "addExperts": {
                  "$ref": "#/definitions/common/experts/experts"
                },
                "addIntegrations": {
                  "$ref": "#/definitions/common/integrations/integrations"
                }
              },
              "required": [
                "namespace"
              ]
            }
          ]
        },
        "optionquestionL": {
          "allOf": [
            {
              "$ref": "#/definitions/local/questions/abstract_question"
            },
            {
              "properties": {
                "answers": {
                  "$ref": "#/definitions/local/answers/optionanswers"
                },
                "addAnswers": {
                  "$ref": "#/definitions/common/answers/optionanswers"
                }
              }
            }
          ]
        },
        "fieldquestionL": {
          "allOf": [
            {
              "$ref": "#/definitions/local/questions/abstract_question"
            },
            {
              "$ref": "#/definitions/common/questions/fieldquestion"
            }
          ]
        },
        "optionquestionC": {
          "allOf": [
            {
              "$ref": "#/definitions/core/questions/abstract_question"
            },
            {
              "properties": {
                "insertBefore": {
                  "$ref": "#/definitions/common/uids/uuid"
                }
              }
            },
            {
              "$ref": "#/definitions/common/questions/optionquestion"
            }
          ]
        },
        "fieldquestionC": {
          "allOf": [
            {
              "$ref": "#/definitions/core/questions/abstract_question"
            },
            {
              "properties": {
                "insertBefore": {
                  "$ref": "#/definitions/common/uids/uuid"
                }
              }
            },
            {
              "$ref": "#/definitions/common/questions/fieldquestion"
            }
          ]
        },
        "question": {
          "anyOf": [
            {
              "$ref": "#/definitions/local/questions/optionquestionL"
            },
            {
              "$ref": "#/definitions/local/questions/fieldquestionL"
            },
            {
              "$ref": "#/definitions/local/questions/optionquestionC"
            },
            {
              "$ref": "#/definitions/local/questions/fieldquestionC"
            }
          ]
        },
        "questions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/local/questions/question"
          },
          "default": []
        }
      },
      "chapter": {
        "allOf": [
          {
            "$ref": "#/definitions/common/chapter"
          },
          {
            "properties": {
              "namespace": {
                "$ref": "#/definitions/local/namespace"
              },
              "questions": {
                "$ref": "#/definitions/local/questions/questions"
              }
            },
            "required": [
              "namespace",
              "questions"
            ]
          }
        ]
      }
    }
  },
  "anyOf": [
    {
      "$ref": "#/definitions/core/chapter"
    },
    {
      "$ref": "#/definitions/local/chapter"
    }
  ]
}
